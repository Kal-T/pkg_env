let usernames = ["Admin"];
let passwords = ["zabbix"];

const url = "http://10.1.9.30/jobarranger/";

describe("UI test", () => {
  beforeEach(() => {
    cy.visit(url);
    cy.url().should("include", "/jobarranger"); //check url
  });

  it("Check UI", () => {
    //elements exist?
    cy.get(".login-title").within(() => {
      cy.get("span").should("contain", "JOB ARRANGER FOR ZABBIX");
    });
    cy.get("#username").should("exist");
    cy.get("#password").should("exist");
    cy.get(".ant-input-suffix").should("exist");
    cy.get(".ant-btn").should("exist");
    cy.get(".ant-btn > span").should("contain", "Submit");

    //typeable test
    cy.get("#username").type("username");
    cy.get("#username").should("have.value", "username");

    cy.get("#password").type("password");
    cy.get("#password").should("have.value", "password");

    //check placeholder
    cy.get("#username").should("have.attr", "placeholder", "Username");
    cy.get("#password").should("have.attr", "placeholder", "Password");

    //click eye button
    cy.get(".ant-input-suffix").click(); // show password
    cy.get(".ant-input-suffix").click(); // hide password
  });
});

describe("Validations", () => {
  beforeEach(() => {
    cy.visit(url);
    cy.url().should("include", "/jobarranger"); //check url
  });

  it("Check empty fields", () => {
    //check password empty
    cy.get("#username").type("username");
    cy.get('button:has(span:contains("Submit"))').click();

    cy.get("div.ant-form-item-explain-error").should(
      "not.contain",
      "Please input your username!"
    );
    cy.get("div.ant-form-item-explain-error").should(
      "contain",
      "Please input your password!"
    );
    cy.get("#username").clear();

    //check username empty
    cy.get("#password").type("password");
    cy.get('button:has(span:contains("Submit"))').click();

    cy.get("div.ant-form-item-explain-error").should(
      "contain",
      "Please input your username!"
    );
    cy.get("div.ant-form-item-explain-error").should(
      "not.contain",
      "Please input your password!"
    );
    cy.get("#password").clear();

    //check username and password empty
    cy.get('button:has(span:contains("Submit"))').click();
    cy.get("div.ant-form-item-explain-error").should(
      "contain",
      "Please input your username!"
    );
    cy.get("div.ant-form-item-explain-error").should(
      "contain",
      "Please input your password!"
    );
  });

  it("Invalid login", () => {
    cy.get("#username").type("username");
    cy.get("#password").type("password");
    cy.get('button:has(span:contains("Submit"))').click();

    cy.get(".ant-modal-confirm-error").should("be.visible");
    cy.get(".ant-modal-confirm-title").should("contain", "Error!");
    cy.get(".ant-modal-confirm-content").should(
      "contain",
      "Incorrect user name or password or account is temporarily blocked."
    );
  });
});

describe("Authentication", () => {
  beforeEach(() => {
    cy.visit(url);
    cy.url().should("include", "/jobarranger"); //check url
  });

  it("Valid Login", () => {
    cy.get("#username").type(usernames[0]);
    cy.get("#password").type(passwords[0]);
    cy.get('button:has(span:contains("Submit"))').click();

    cy.url().should("eq", url + "home");
    cy.get("span.ant-breadcrumb-link > a").should("contain", "Home");
  });

  it("Logout", () => {
    cy.get("#username").type(usernames[0]);
    cy.get("#password").type(passwords[0]);
    cy.get('button:has(span:contains("Submit"))').click();

    cy.url().should("eq", url + "home");
    cy.get("span.ant-breadcrumb-link > a").should("contain", "Home");
    cy.get("#root > section > aside > div > ul > li:nth-child(9)").click();
    cy.get(
      "body > div:nth-child(5) > div > div.ant-modal-wrap.ant-modal-centered > div > div.ant-modal-content > div.ant-modal-body > div"
    ).should("contain", "I finish the job manager.Are you all right?");

    cy.get(
      "body > div:nth-child(5) > div > div.ant-modal-wrap.ant-modal-centered > div > div.ant-modal-content > div.ant-modal-footer > button.ant-btn.ant-btn-primary"
    ).click();

    cy.url().should("include", "/jobarranger"); //check url
  });
});
